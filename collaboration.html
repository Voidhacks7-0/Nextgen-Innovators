<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVVV | Collaboration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy-dark: #0f2c4e; --navy-light: #1e3a8a; --accent-yellow: #fbbf24;
            --bg-body: #f8fafc; --bg-surface: #ffffff; --text-main: #1e293b; --text-muted: #64748b;
            --border: #e2e8f0; --sidebar-width: 260px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-body); color: var(--text-main); display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar { width: var(--sidebar-width); background: var(--navy-dark); color: white; position: fixed; height: 100vh; display: flex; flex-direction: column; z-index: 100; }
        .logo-area { padding: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo-text { font-size: 2rem; font-weight: 800; letter-spacing: -1px; color: #fff; }
        .logo-sub { font-size: 0.75rem; color: var(--accent-yellow); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .nav-menu { padding: 2rem 1rem; flex: 1; list-style: none; }
        .nav-link { display: flex; align-items: center; padding: 1rem; color: rgba(255,255,255,0.7); text-decoration: none; border-radius: 8px; margin-bottom: 0.5rem; font-weight: 500; transition: 0.2s; }
        .nav-link:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .nav-link.active { background: var(--accent-yellow); color: var(--navy-dark); font-weight: 700; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3); }
        .nav-link i { width: 24px; margin-right: 12px; }

        /* Main Content */
        .main { margin-left: var(--sidebar-width); flex: 1; padding: 2rem; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .header h1 { font-size: 2rem; font-weight: 800; color: var(--navy-dark); margin-bottom: 1rem; }

        /* Tabs */
        .tabs { display: flex; gap: 1.5rem; border-bottom: 2px solid #e2e8f0; margin-bottom: 1.5rem; flex-shrink: 0; }
        .tab-btn { background: none; border: none; padding: 1rem 0; font-family: inherit; font-size: 1.1rem; font-weight: 600; color: var(--text-muted); cursor: pointer; position: relative; transition: 0.3s; }
        .tab-btn:hover { color: var(--navy-dark); }
        .tab-btn.active { color: var(--navy-dark); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 3px; background: var(--accent-yellow); }

        .content-section { flex: 1; display: none; overflow-y: auto; padding-right: 10px; animation: fadeIn 0.3s; }
        .content-section.active { display: block; }
        #chat.active { display: flex; flex-direction: row; gap: 1.5rem; overflow: hidden; background: #fff; border: 1px solid var(--border); border-radius: 12px; height: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI Components --- */
        .btn-navy { background: var(--navy-dark); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-navy:hover { background: #1a3c61; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-outline { background: white; border: 2px solid var(--navy-dark); color: var(--navy-dark); padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn-outline:hover { background: #f1f5f9; }

        /* 1. Forums Styles */
        .topic-card { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border-left: 5px solid transparent; transition: 0.2s; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .topic-card:hover { border-color: var(--accent-yellow); border-left-color: var(--accent-yellow); transform: translateX(5px); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .badge-cat { font-size: 0.75rem; background: #e0f2fe; color: #0284c7; padding: 4px 8px; border-radius: 4px; font-weight: 600; margin-right: 8px; }

        /* 2. Projects Styles */
        .projects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; padding-bottom: 2rem; }
        .project-card { background: #fff; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; transition: 0.3s; }
        .project-card:hover { transform: translateY(-5px); border-color: var(--navy-dark); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .skill-tag { background: #f1f5f9; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; margin-right: 5px; color: var(--text-muted); font-weight: 500; }

        /* 3. Chat Styles (Split Layout) */
        .chat-sidebar { width: 280px; border-right: 1px solid var(--border); background: #f8fafc; display: flex; flex-direction: column; }
        .chat-main { flex: 1; display: flex; flex-direction: column; background: #fff; position: relative; }
        
        .contact-item { padding: 1rem; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .contact-item:hover { background: #e2e8f0; }
        .contact-item.active { background: #eff6ff; border-left: 4px solid var(--navy-dark); }
        .contact-avatar { width: 40px; height: 40px; border-radius: 50%; background: #cbd5e1; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--navy-dark); }
        
        .chat-messages { flex: 1; padding: 2rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; }
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 70%; font-size: 0.95rem; line-height: 1.5; }
        .msg.me { align-self: flex-end; background: var(--navy-dark); color: white; border-bottom-right-radius: 0; }
        .msg.other { align-self: flex-start; background: #f1f5f9; border: 1px solid var(--border); border-bottom-left-radius: 0; color: var(--text-main); }
        
        .chat-input-area { padding: 1rem; border-top: 1px solid var(--border); display: flex; gap: 1rem; background: white; }
        .chat-input-area input { flex: 1; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-family: inherit; outline: none; }
        .chat-input-area input:focus { border-color: var(--navy-dark); }

        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 44, 78, 0.7); backdrop-filter: blur(4px); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; padding: 2rem; border-radius: 16px; width: 100%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-height: 85vh; display: flex; flex-direction: column; }
        
        /* Thread Modal specific */
        .thread-comments { flex: 1; overflow-y: auto; margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 8px; border: 1px solid var(--border); max-height: 300px; }
        .comment-item { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
        .comment-user { font-weight: 700; color: var(--navy-dark); font-size: 0.85rem; }
        
        /* Inputs */
        .form-input { width: 100%; padding: 12px; margin: 8px 0 16px; border: 2px solid var(--border); border-radius: 8px; font-family: inherit; outline: none; }
        .form-input:focus { border-color: var(--navy-dark); }
        
        /* Toast */
        .toast { position: fixed; bottom: 30px; right: 30px; background: var(--navy-dark); color: var(--accent-yellow); padding: 1rem 2rem; border-radius: 8px; font-weight: 600; transform: translateY(100px); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 2000; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        .toast.show { transform: translateY(0); }

        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; padding: 1rem; } .chat-sidebar { width: 70px; } .contact-name { display: none; } }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo-area"><div class="logo-text">SVVV</div><div class="logo-sub">Student Portal</div></div>
        <ul class="nav-menu">
            <li><a href="dashboard.html" class="nav-link"><i class="fas fa-th-large"></i> Dashboard</a></li>
            <li><a href="schedule.html" class="nav-link"><i class="far fa-calendar-alt"></i> Schedule</a></li>
            <li><a href="resources.html" class="nav-link"><i class="fas fa-layer-group"></i> Resources</a></li>
            <li><a href="academics.html" class="nav-link"><i class="fas fa-graduation-cap"></i> Academics</a></li>
            <li><a href="collaboration.html" class="nav-link active"><i class="fas fa-users"></i> Collaboration</a></li>
        </ul>
    </nav>

    <main class="main">
        <h1 class="header" style="font-size: 2rem; font-weight: 800; color: var(--navy-dark); margin-bottom: 1rem;">Collaboration Hub</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('forums')">Discussion Forums</button>
            <button class="tab-btn" onclick="switchTab('projects')">Project Matchmaking</button>
            <button class="tab-btn" onclick="switchTab('chat')">Team Chat</button>
        </div>

        <div id="forums" class="content-section active">
            <div style="display: flex; justify-content: flex-end; margin-bottom: 1.5rem;">
                <button class="btn-navy" onclick="openModal('newTopicModal')"><i class="fas fa-plus"></i> New Topic</button>
            </div>
            <div id="topicContainer">
                </div>
        </div>

        <div id="projects" class="content-section">
            <div style="display: flex; justify-content: flex-end; margin-bottom: 1.5rem;">
                <button class="btn-navy" onclick="openModal('newProjectModal')"><i class="fas fa-plus"></i> Post Project</button>
            </div>
            <div class="projects-grid" id="projectsContainer">
                </div>
        </div>

        <div id="chat" class="content-section">
            <div class="chat-sidebar">
                <div class="contact-item active" onclick="loadChat(0)">
                    <div class="contact-avatar">T</div>
                    <div class="contact-name">
                        <div style="font-weight:700; color:var(--navy-dark);">Team Alpha</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Hackathon Group</div>
                    </div>
                </div>
                <div class="contact-item" onclick="loadChat(1)">
                    <div class="contact-avatar">S</div>
                    <div class="contact-name">
                        <div style="font-weight:700; color:var(--navy-dark);">Dr. Sharma</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Faculty Advisor</div>
                    </div>
                </div>
                <div class="contact-item" onclick="loadChat(2)">
                    <div class="contact-avatar">A</div>
                    <div class="contact-name">
                        <div style="font-weight:700; color:var(--navy-dark);">Alice</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Class Rep</div>
                    </div>
                </div>
            </div>
            <div class="chat-main">
                <div class="chat-messages" id="chatArea">
                    </div>
                <form class="chat-input-area" onsubmit="sendMessage(event)">
                    <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off">
                    <button type="submit" class="btn-navy"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="threadModal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 id="threadTitle" style="color:var(--navy-dark); font-size:1.5rem;">Topic Title</h2>
                <button onclick="closeModal('threadModal')" style="border:none; background:none; font-size:1.2rem; cursor:pointer;">&times;</button>
            </div>
            <p id="threadMeta" style="color:var(--text-muted); margin-bottom:1rem; font-size:0.9rem;">Posted by User</p>
            <div class="thread-comments" id="threadComments">
                </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="replyInput" class="form-input" placeholder="Write a reply..." style="margin:0;">
                <button class="btn-navy" onclick="postReply()">Reply</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="newTopicModal">
        <div class="modal-box">
            <h2 style="color:var(--navy-dark); margin-bottom:1rem;">Create New Topic</h2>
            <label style="font-weight:600; color:var(--navy-dark);">Title</label>
            <input type="text" id="newTopicTitle" class="form-input" placeholder="e.g. Help with OS Lab">
            <label style="font-weight:600; color:var(--navy-dark);">Category</label>
            <input type="text" id="newTopicCat" class="form-input" placeholder="Academic / Event">
            <div style="text-align:right; margin-top:1rem;">
                <button class="btn-outline" onclick="closeModal('newTopicModal')">Cancel</button>
                <button class="btn-navy" onclick="createNewTopic()">Post</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="applyModal">
        <div class="modal-box">
            <h2 style="color:var(--navy-dark); margin-bottom:1rem;">Join Project</h2>
            <p style="color:var(--text-muted); margin-bottom:1rem;">Why do you want to join this team?</p>
            <textarea class="form-input" rows="4" placeholder="Briefly describe your skills..."></textarea>
            <div style="text-align:right;">
                <button class="btn-outline" onclick="closeModal('applyModal')">Cancel</button>
                <button class="btn-navy" onclick="submitApplication()">Send Request</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="newProjectModal">
        <div class="modal-box">
            <h2 style="color:var(--navy-dark); margin-bottom:1rem;">Post New Project</h2>
            <label style="font-weight:600;">Project Name</label>
            <input type="text" id="npTitle" class="form-input">
            <label style="font-weight:600;">Description</label>
            <textarea id="npDesc" class="form-input" rows="2"></textarea>
            <div style="text-align:right;">
                <button class="btn-outline" onclick="closeModal('newProjectModal')">Cancel</button>
                <button class="btn-navy" onclick="createNewProject()">Create</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"><i class="fas fa-check-circle"></i> <span>Success!</span></div>

    <script>
        // --- Data Models ---
        let topics = [
            { id:1, title: "Hackathon Team Formation", cat: "Event", author: "Alice", replies: [ {user:"Bob", text:"I am interested! I know React."} ] },
            { id:2, title: "CS302 Mid-Sem Syllabus?", cat: "Academic", author: "Charlie", replies: [ {user:"Dave", text:"It covers Units 1, 2 and 3."}, {user:"Alice", text:"Thanks!"} ] }
        ];

        let projects = [
            { id:1, title: "Smart Canteen App", desc: "Flutter based ordering system.", skills: ["Flutter", "Firebase"], applied: false },
            { id:2, title: "AI Attendance", desc: "Python face recognition.", skills: ["Python", "OpenCV"], applied: false }
        ];

        let chats = [
            [ // Chat 0 (Team Alpha)
                { text: "Guys, submission is tomorrow!", own: false },
                { text: "I'm almost done with the backend.", own: true },
                { text: "Great, I'll finish the UI tonight.", own: false }
            ],
            [ // Chat 1 (Dr. Sharma)
                { text: "Please submit your synopsis by Friday.", own: false },
                { text: "Sure sir, will do.", own: true }
            ],
            [ // Chat 2 (Alice)
                { text: "Do you have the notes for Unit 4?", own: false }
            ]
        ];
        
        let currentChatIdx = 0;
        let currentThreadId = null;
        let pendingProjectId = null;

        // --- Tabs Logic ---
        function switchTab(id) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        // --- Render Functions ---
        function renderTopics() {
            const container = document.getElementById('topicContainer');
            container.innerHTML = topics.map(t => `
                <div class="topic-card" onclick="openThread(${t.id})">
                    <div>
                        <h3 style="color:var(--navy-dark); margin-bottom:5px;">${t.title}</h3>
                        <p style="color:var(--text-muted); font-size:0.85rem;">
                            <span class="badge-cat">${t.cat}</span> Posted by ${t.author}
                        </p>
                    </div>
                    <div style="font-weight:700; color:var(--navy-dark);"><i class="fas fa-comment-alt" style="color:var(--accent-yellow)"></i> ${t.replies.length}</div>
                </div>
            `).join('');
        }

        function renderProjects() {
            const container = document.getElementById('projectsContainer');
            container.innerHTML = projects.map(p => `
                <div class="project-card">
                    <h3 style="color:var(--navy-dark); margin-bottom:5px;">${p.title}</h3>
                    <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem; flex:1;">${p.desc}</p>
                    <div style="margin-bottom:1rem;">${p.skills.map(s=>`<span class="skill-tag">${s}</span>`).join('')}</div>
                    <button class="btn-navy" style="width:100%; opacity:${p.applied ? '0.6' : '1'}" 
                        onclick="${p.applied ? '' : `openApplyModal(${p.id})`}">
                        ${p.applied ? 'Request Sent' : 'Join Project'}
                    </button>
                </div>
            `).join('');
        }

        function renderChat() {
            const area = document.getElementById('chatArea');
            area.innerHTML = chats[currentChatIdx].map(msg => `
                <div class="msg ${msg.own ? 'me' : 'other'}">${msg.text}</div>
            `).join('');
            area.scrollTop = area.scrollHeight;
            
            // Update sidebar active state
            document.querySelectorAll('.contact-item').forEach((el, idx) => {
                el.classList.toggle('active', idx === currentChatIdx);
            });
        }

        // --- Forum Logic ---
        function openThread(id) {
            currentThreadId = id;
            const topic = topics.find(t => t.id === id);
            document.getElementById('threadTitle').innerText = topic.title;
            document.getElementById('threadMeta').innerText = `Posted by ${topic.author} in ${topic.cat}`;
            renderComments(topic);
            openModal('threadModal');
        }

        function renderComments(topic) {
            const container = document.getElementById('threadComments');
            container.innerHTML = topic.replies.map(r => `
                <div class="comment-item">
                    <div class="comment-user">${r.user}</div>
                    <div style="font-size:0.9rem; color:var(--text-main);">${r.text}</div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function postReply() {
            const input = document.getElementById('replyInput');
            if(!input.value.trim()) return;
            const topic = topics.find(t => t.id === currentThreadId);
            topic.replies.push({ user: "You", text: input.value });
            input.value = '';
            renderComments(topic);
            renderTopics(); // Update count
        }

        function createNewTopic() {
            const title = document.getElementById('newTopicTitle').value;
            const cat = document.getElementById('newTopicCat').value;
            if(title && cat) {
                topics.unshift({ id: Date.now(), title, cat, author: "You", replies: [] });
                closeModal('newTopicModal');
                renderTopics();
                showToast('Topic Posted!');
            }
        }

        // --- Project Logic ---
        function openApplyModal(id) {
            pendingProjectId = id;
            openModal('applyModal');
        }

        function submitApplication() {
            const proj = projects.find(p => p.id === pendingProjectId);
            if(proj) {
                proj.applied = true;
                renderProjects();
                closeModal('applyModal');
                showToast('Application Sent!');
            }
        }

        function createNewProject() {
            const title = document.getElementById('npTitle').value;
            const desc = document.getElementById('npDesc').value;
            if(title && desc) {
                projects.unshift({ id: Date.now(), title, desc, skills: ["New"], applied: false });
                closeModal('newProjectModal');
                renderProjects();
                showToast('Project Created!');
            }
        }

        // --- Chat Logic ---
        function loadChat(idx) {
            currentChatIdx = idx;
            renderChat();
        }

        function sendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('chatInput');
            if(input.value.trim()) {
                chats[currentChatIdx].push({ text: input.value, own: true });
                input.value = '';
                renderChat();
            }
        }

        // --- Utilities ---
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.querySelector('span').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // Init
        renderTopics();
        renderProjects();
        renderChat();

    </script>
</body>
</html>