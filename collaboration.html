<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Campus Connect - Collaboration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --color-bg: #f9fafb;
            --color-primary: #667eea;
            --color-primary-dark: #4c51bf;
            --color-secondary: #f6ad55;
            --color-text: #2d3748;
            --color-muted: #718096;
            --border-radius: 16px;
            --transition: all 0.3s ease;
            --shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Layout */
        .container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* Sidebar */
        nav.sidebar {
            width: 280px;
            background: var(--color-primary);
            color: white;
            display: flex;
            flex-direction: column;
            padding-top: 40px;
            padding-bottom: 40px;
            user-select: none;
        }
        nav.sidebar h2 {
            font-weight: 800;
            font-size: 1.9rem;
            margin-bottom: 50px;
            text-align: center;
            letter-spacing: 1px;
        }
        nav.sidebar ul {
            list-style: none;
            flex-grow: 1;
        }
        nav.sidebar ul li {
            padding: 18px 40px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: background-color 0.25s ease;
        }
        nav.sidebar ul li:hover,
        nav.sidebar ul li.active {
            background-color: var(--color-primary-dark);
        }
        nav.sidebar ul li i {
            font-size: 1.4rem;
            width: 28px;
            text-align: center;
        }

        /* Main area */
        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        header.main-header {
            padding: 24px 32px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 800;
            font-size: 1.8rem;
            color: var(--color-primary-dark);
            background: #f5f7ff;
            user-select: none;
        }

        /* Content sections */
        section.content {
            flex-grow: 1;
            padding: 30px 32px;
            overflow-y: auto;
        }

        /* Forums */
        .forums-topics {
            display: flex;
            flex-direction: column;
            gap: 22px;
            max-width: 900px;
            margin-top: 20px;
        }
        .forums-topic-card {
            background: white;
            padding: 22px 28px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .forums-topic-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 45px rgba(102, 126, 234, 0.3);
        }
        .forums-topic-info {
            display: flex;
            flex-direction: column;
        }
        .forums-topic-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 6px;
            color: var(--color-primary-dark);
        }
        .forums-topic-meta {
            font-size: 0.85rem;
            color: var(--color-muted);
            display: flex;
            gap: 20px;
        }

        /* Forum replies (inside modal) */
        .forum-replies {
            max-height: 380px;
            overflow-y: auto;
            margin-top: 24px;
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
        }
        .reply {
            background: var(--color-bg);
            padding: 14px 18px;
            border-radius: 14px;
            margin-bottom: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }
        .reply-header {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
            color: var(--color-primary-dark);
        }
        .reply-content {
            font-size: 0.9rem;
            color: var(--color-text);
            white-space: pre-wrap;
        }

        /* Forum editor */
        .forum-editor {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .forum-editor textarea {
            width: 100%;
            min-height: 90px;
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            padding: 14px 18px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
            outline-offset: 2px;
            transition: var(--transition);
        }
        .forum-editor textarea:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.25);
        }
        .forum-editor button {
            align-self: flex-end;
            padding: 12px 28px;
            border: none;
            border-radius: 14px;
            background: var(--color-primary);
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }
        .forum-editor button:hover:not(:disabled) {
            background: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
        }
        .forum-editor button:disabled {
            background: #b0b7ff;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Group Chat */
        .chat-container {
            max-width: 900px;
            display: flex;
            flex-direction: column;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            height: calc(100vh - 128px);
            background: white;
            overflow: hidden;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: var(--color-bg);
        }
        .chat-message {
            display: flex;
            gap: 14px;
            max-width: 75%;
        }
        .chat-message.own {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        .chat-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background-color: var(--color-primary);
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            user-select: none;
        }
        .chat-bubble {
            background: white;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            box-shadow: var(--shadow-sm);
            position: relative;
            font-size: 1rem;
            word-wrap: break-word;
        }
        .chat-bubble.own {
            background: var(--color-primary);
            color: white;
        }
        .chat-meta {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
            text-align: right;
        }

        /* Chat input */
        .chat-input-area {
            display: flex;
            padding: 24px;
            border-top: 1px solid #e2e8f0;
            gap: 16px;
            background: white;
        }
        .chat-input-area input {
            flex-grow: 1;
            border-radius: var(--border-radius);
            border: 2px solid #e2e8f0;
            padding: 12px 16px;
            font-size: 1.1rem;
            transition: var(--transition);
            outline-offset: 3px;
        }
        .chat-input-area input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }
        .chat-input-area button {
            background: var(--color-primary);
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 24px;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            font-weight: 700;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            user-select: none;
        }
        .chat-input-area button:disabled {
            background: #a5b4fc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .chat-input-area button:hover:not(:disabled) {
            background: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
        }

        /* Project Matchmaking */
        .projects-list {
            max-width: 950px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(440px, 1fr));
            gap: 30px;
        }
        .project-card {
            background: white;
            padding: 30px 28px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            user-select: none;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .project-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .project-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--color-primary-dark);
            max-width: 75%;
        }
        .project-team-size {
            font-weight: 600;
            background: var(--color-primary);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .project-desc {
            color: #475569;
            font-size: 1rem;
            margin: 12px 0 16px;
            flex-grow: 1;
        }
        .project-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 22px;
        }
        .skill {
            background: var(--color-secondary);
            color: white;
            padding: 6px 14px;
            border-radius: 18px;
            font-weight: 600;
            font-size: 0.85rem;
            user-select: none;
        }
        .join-btn {
            border: none;
            padding: 16px 28px;
            background: var(--color-primary);
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }
        .join-btn:hover {
            background: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-3px);
        }

        /* Project Modal */
        .modal-project-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100vh;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1100;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-project-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-project-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 40px 35px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 480px;
            width: 100%;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-project-header {
            text-align: center;
            margin-bottom: 28px;
        }
        .modal-project-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-primary-dark);
            margin-bottom: 8px;
        }
        .modal-project-close {
            position: absolute;
            top: 24px;
            right: 28px;
            border: none;
            background: transparent;
            font-size: 1.6rem;
            cursor: pointer;
            color: var(--color-muted);
            padding: 4px;
            transition: color 0.3s ease;
            user-select: none;
        }
        .modal-project-close:hover {
            color: var(--color-primary);
        }
        .form-group {
            margin-bottom: 28px;
        }
        .form-group label {
            display: block;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 10px;
            font-size: 1rem;
            user-select: none;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
            background: white;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 6px rgba(102, 126, 234, 0.2);
        }
        .btn {
            padding: 16px 28px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            width: 100%;
            user-select: none;
        }
        .btn:hover {
            background: var(--color-primary-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-3px);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container { flex-direction: column; height: auto; }
            nav.sidebar { width: 100%; display: flex; padding: 0; border-radius: 0; justify-content: space-around; }
            nav.sidebar ul { display: flex; margin: 0; width: 100%; }
            nav.sidebar ul li { flex-grow: 1; text-align: center; padding: 18px 0; }
            main { height: auto; }
            .chat-container, .resources-grid, .forums-topics, .projects-list { max-width: 100%; }
        }

        @media (max-width: 480px) {
            body { font-size: 14px; }
            nav.sidebar ul li { font-size: 0.9rem; padding: 14px 0; }
            .header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar" role="navigation" aria-label="Primary">
            <h2>Collaboration</h2>
            <ul>
                <li class="active" data-tab="forums"><i class="fas fa-comments"></i> Forums</li>
                <li data-tab="chat"><i class="fas fa-comments-alt"></i> Group Chat</li>
                <li data-tab="projects"><i class="fas fa-project-diagram"></i> Project Matchmaking</li>
            </ul>
        </nav>
        <main>
            <header class="main-header" id="pageTitle">Forums</header>

            <!-- Forums Section -->
            <section id="forums" class="content active">
                <button id="btnNewTopic" class="btn" style="background: var(--color-primary); margin-bottom: 24px; max-width: 180px;">
                    <i class="fas fa-plus"></i> New Topic
                </button>
                <div class="forums-topics" id="topicsContainer" aria-live="polite" aria-relevant="additions">
                    <!-- Forum topics injected by JS -->
                </div>
            </section>

            <!-- Chat Section -->
            <section id="chat" class="content" aria-live="polite" aria-label="Group chat area" tabindex="0" style="display:none;">
                <div class="chat-container" role="application" aria-roledescription="chat">
                    <div class="chat-messages" id="chatMessages" aria-live="polite" aria-relevant="additions">
                        <!-- Messages appended here -->
                    </div>
                    <form id="chatForm" class="chat-input-area" aria-label="Send message form">
                        <input type="text" id="chatInput" placeholder="Write a message..." aria-label="Message input" autocomplete="off" required />
                        <button type="submit" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
            </section>

            <!-- Projects Section -->
            <section id="projects" class="content" style="display:none;">
                <button id="btnNewProject" class="btn" style="background: var(--color-primary); margin-bottom: 24px; max-width: 200px;">
                    <i class="fas fa-plus"></i> Create Project
                </button>
                <div class="projects-list" id="projectsContainer" aria-live="polite" aria-relevant="additions">
                    <!-- Project cards injected by JS -->
                </div>
            </section>
        </main>
    </div>

    <!-- New Topic Modal -->
    <div class="modal-overlay" id="forumModal" tabindex="-1" aria-hidden="true" aria-labelledby="forumModalTitle" role="dialog">
        <div class="modal-content" role="document">
            <button class="close-btn" aria-label="Close new topic dialog" id="closeForumModal"><i class="fas fa-times"></i></button>
            <h3 id="forumModalTitle" style="font-weight: 900; margin-bottom: 12px; color: var(--color-primary-dark);">Post New Topic</h3>
            <form id="forumForm">
                <div class="form-group">
                    <label for="forumTopicTitle"><i class="fas fa-heading"></i> Topic Title</label>
                    <input type="text" id="forumTopicTitle" name="topicTitle" placeholder="Enter topic title" required minlength="3" maxlength="90" autocomplete="off" />
                </div>
                <div class="form-group">
                    <label for="forumTopicCategory"><i class="fas fa-tags"></i> Category</label>
                    <select id="forumTopicCategory" name="topicCategory" required>
                        <option value="">Select category</option>
                        <option>Hackathon</option>
                        <option>Group Assignment</option>
                        <option>General Discussion</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="forumTopicContent"><i class="fas fa-comment"></i> Content</label>
                    <textarea id="forumTopicContent" name="topicContent" rows="6" placeholder="Write your message..." required minlength="5"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Post Topic</button>
            </form>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal-project-overlay" id="projectModal" tabindex="-1" aria-hidden="true" role="dialog" aria-labelledby="projectModalTitle" aria-modal="true">
        <div class="modal-project-content">
            <button class="modal-project-close" aria-label="Close project creation dialog" id="closeProjectModal"><i class="fas fa-times"></i></button>
            <div class="modal-project-header">
                <h2 id="projectModalTitle">Create New Project Listing</h2>
            </div>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectTitle"><i class="fas fa-heading"></i> Project Title</label>
                    <input type="text" id="projectTitle" placeholder="Name your project" required minlength="3" maxlength="100" autocomplete="off" />
                </div>
                <div class="form-group">
                    <label for="projectDesc"><i class="fas fa-info-circle"></i> Description</label>
                    <textarea id="projectDesc" rows="5" placeholder="Briefly describe the project goals and scope" required minlength="15"></textarea>
                </div>
                <div class="form-group">
                    <label for="projectSkills"><i class="fas fa-lightbulb"></i> Required Skills (comma separated)</label>
                    <input type="text" id="projectSkills" placeholder="E.g., React, Node.js, Design" required />
                </div>
                <div class="form-group">
                    <label for="projectTeamSize"><i class="fas fa-users"></i> Team Size (Max)</label>
                    <input type="number" id="projectTeamSize" min="1" max="15" required value="4" />
                </div>
                <button type="submit" class="btn btn-primary">Create Project</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" style="
        position: fixed;
        bottom: 30px;
        right: 30px;
        padding: 18px 30px;
        background: var(--color-primary);
        color: white;
        border-radius: 20px;
        box-shadow: var(--shadow-lg);
        font-weight: 600;
        font-size: 1rem;
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 0.4s ease, transform 0.4s ease;
        pointer-events: none;
        z-index: 2000;
    " role="alert" aria-live="assertive" aria-atomic="true"></div>

    <script>
        // Navigation Tabs
        const tabs = document.querySelectorAll('nav.sidebar ul li');
        const contents = {
            forums: document.getElementById('forums'),
            chat: document.getElementById('chat'),
            projects: document.getElementById('projects'),
        };
        const pageTitle = document.getElementById('pageTitle');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                Object.values(contents).forEach(c => c.style.display = 'none');
                contents[tab.dataset.tab].style.display = 'block';
                pageTitle.textContent = tab.textContent.trim();
                if (tab.dataset.tab === 'chat') chatInput.focus();
            });
        });

        // Initial tab
        contents.chat.style.display = 'none';
        contents.projects.style.display = 'none';

        /* =======================
           Forums Module Logic 
        ========================= */
        const forumsTopicsElem = document.getElementById('topicsContainer');
        const forumModal = document.getElementById('forumModal');
        const forumForm = document.getElementById('forumForm');
        const btnNewTopic = document.getElementById('btnNewTopic');
        const btnForumClose = document.getElementById('closeForumModal');

        // Dummy forum data
        let forumsTopics = [
            {
                id: 1,
                title: "Hackathon Ideas for Beginners",
                category: "Hackathon",
                creator: "Alice",
                createdAt: new Date(Date.now() - (2*3600*1000)), // 2h ago
                replies: [
                    { name: "Bob", text: "We could build a campus app!", time: new Date(Date.now() - (1*3600*1000)) }, // 1h ago
                    { name: "Clara", text: "Agree! Maybe also a COVID-19 tracker?", time: new Date(Date.now() - (45*60*1000)) } // 45m ago
                ]
            },
            {
                id: 2,
                title: "Group Assignment: Best Collaboration Tools?",
                category: "Group Assignment",
                creator: "Eve",
                createdAt: new Date(Date.now() - (24*3600*1000)), // 1 day ago
                replies: []
            }
        ];

        function timeAgo(dt) {
            const diff = Date.now() - dt.getTime();
            if(diff < 60000) return "Just now";
            if(diff < 3600000) return Math.floor(diff/60000) + " min ago";
            if(diff < 86400000) return Math.floor(diff/3600000) + "h ago";
            return Math.floor(diff/86400000) + "d ago";
        }

        function renderTopics() {
            if (!forumsTopics.length) {
                forumsTopicsElem.innerHTML = '<p style="color: var(--color-muted); font-style: italic;">No topics yet. Be the first to post!</p>';
                return;
            }

            forumsTopicsElem.innerHTML = '';
            forumsTopics.forEach(topic => {
                const card = document.createElement('div');
                card.className = 'forums-topic-card';
                card.setAttribute('tabindex', 0);
                card.setAttribute('role', 'button');
                card.setAttribute('aria-expanded', 'false');
                card.innerHTML = `
                    <div class="forums-topic-info">
                        <div class="forums-topic-title">${topic.title}</div>
                        <div class="forums-topic-meta">
                            <span>Category: ${topic.category}</span>
                            <span>Created by ${topic.creator}</span>
                            <span>${timeAgo(topic.createdAt)}</span>
                            <span>${topic.replies.length} ${topic.replies.length === 1 ? 'Reply' : 'Replies'}</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                `;
                card.addEventListener('click', () => openTopicModal(topic.id));
                card.addEventListener('keydown', e => {
                    if(e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        openTopicModal(topic.id);
                    }
                });
                forumsTopicsElem.appendChild(card);
            });
        }

        btnNewTopic.addEventListener('click', () => {
            openTopicModal(); // New topic modal
        });

        btnForumClose.addEventListener('click', closeTopicModal);

        let currentTopic = null;
        function openTopicModal(topicId) {
            // Build modal content, for simplification use native prompt for replies in demo
            if(topicId) {
                currentTopic = forumsTopics.find(t => t.id === topicId);
                // Show topic dialog with replies and editor
                showForumThread(currentTopic);
            } else {
                // New topic form
                showForumNewTopicForm();
            }
        }

        // Forum thread modal dynamic creation
        function showForumThread(topic) {
            // Clear modal content, reuse forumModal
            const modal = forumModal.querySelector('.modal-content');
            modal.innerHTML = `
                <button class="close-btn" id="forumThreadClose" aria-label="Close topic"><i class="fas fa-times"></i></button>
                <h3 class="modal-title">${topic.title}</h3>
                <p><strong>Category:</strong> ${topic.category} &nbsp;&nbsp; <strong>Created by:</strong> ${topic.creator}</p>
                <div class="forum-replies" aria-live="polite" aria-relevant="additions"></div>
                <form class="forum-editor" aria-label="New reply form">
                    <textarea required placeholder="Write your reply here..."></textarea>
                    <button type="submit">Post Reply</button>
                </form>
            `;
            forumModal.classList.add('active');
            document.getElementById('forumModal').setAttribute('aria-hidden', 'false');

            // Close button
            document.getElementById('forumThreadClose').onclick = closeTopicModal;

            const repliesContainer = modal.querySelector('.forum-replies');
            const editorForm = modal.querySelector('.forum-editor');
            const textarea = editorForm.querySelector('textarea');

            function renderReplies() {
                repliesContainer.innerHTML = '';
                topic.replies.forEach(reply => {
                    const r = document.createElement('div');
                    r.className = 'reply';
                    r.innerHTML = `
                        <div class="reply-header">${reply.name} <small> · ${timeAgo(reply.time)}</small></div>
                        <div class="reply-content">${reply.text}</div>
                    `;
                    repliesContainer.appendChild(r);
                });
                repliesContainer.scrollTop = repliesContainer.scrollHeight;
            }
            renderReplies();

            editorForm.addEventListener('submit', e => {
                e.preventDefault();
                if (!textarea.value.trim()) return;
                topic.replies.push({ name: 'You', text: textarea.value.trim(), time: new Date() });
                textarea.value = '';
                renderReplies();
                // Update topics list to reflect new reply count
                renderTopics();
            });
        }

        function showForumNewTopicForm() {
            const modal = forumModal.querySelector('.modal-content');
            modal.innerHTML = `
                <button class="close-btn" id="forumNewTopicClose" aria-label="Close new topic dialog"><i class="fas fa-times"></i></button>
                <h3 class="modal-title">Create New Topic</h3>
                <form id="newTopicForm" aria-label="New topic form">
                    <div class="form-group">
                        <label for="topicTitle">Topic Title</label>
                        <input type="text" id="topicTitle" name="topicTitle" placeholder="Enter topic title" required minlength="3" maxlength="90" autocomplete="off" />
                    </div>
                    <div class="form-group">
                        <label for="topicCategory">Category</label>
                        <select id="topicCategory" name="topicCategory" required>
                            <option value="">Select category</option>
                            <option>Hackathon</option>
                            <option>Group Assignment</option>
                            <option>General Discussion</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="topicContent">Content</label>
                        <textarea id="topicContent" name="topicContent" rows="5" placeholder="Write your message..." required minlength="5"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Post Topic</button>
                </form>
            `;
            forumModal.classList.add('active');
            document.getElementById('forumModal').setAttribute('aria-hidden', 'false');
            document.getElementById('topicTitle').focus();
            document.getElementById('forumNewTopicClose').onclick = closeTopicModal;
            document.getElementById('newTopicForm').onsubmit = e => {
                e.preventDefault();
                const title = e.target.topicTitle.value.trim();
                const category = e.target.topicCategory.value;
                const content = e.target.topicContent.value.trim();
                if(!title || !category || !content) return;

                forumsTopics.unshift({
                    id: Date.now(),
                    title,
                    category,
                    creator: 'You',
                    createdAt: new Date(),
                    replies: [{ name: 'You', text: content, time: new Date() }]
                });
                closeTopicModal();
                renderTopics();
            };
        }

        function closeTopicModal() {
            forumModal.classList.remove('active');
            document.getElementById('forumModal').setAttribute('aria-hidden', 'true');
        }

        renderTopics();

        /* =======================
           Group Chat Logic 
        ========================= */
        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');

        // Dummy chat data
        let chatData = [
            { user: 'Alice', avatar: 'A', text: "Hey! Anyone up for the hackathon?", time: new Date(Date.now() - 1000*60*15), own: false },
            { user: 'You', avatar: 'Y', text: "Count me in! Let’s build something cool.", time: new Date(Date.now() - 1000*60*10), own: true },
            { user: 'Bob', avatar: 'B', text: "What about a campus navigation app?", time: new Date(Date.now() - 1000*60*5), own: false },
        ];

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function renderChat() {
            chatMessages.innerHTML = '';
            chatData.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `chat-message ${msg.own ? 'own' : ''}`;
                msgDiv.innerHTML = `
                    <div class="chat-avatar" aria-label="User avatar">${msg.avatar}</div>
                    <div>
                        <div class="chat-bubble ${msg.own ? 'own' : ''}" role="article" aria-label="${msg.user}'s message">${msg.text}</div>
                        <div class="chat-meta" aria-live="polite">${msg.user} · ${formatTime(msg.time)}</div>
                    </div>
                `;
                chatMessages.appendChild(msgDiv);
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        chatForm.addEventListener('submit', e => {
            e.preventDefault();
            if(!chatInput.value.trim()) return;
            chatData.push({
                user: 'You',
                avatar: 'Y',
                text: chatInput.value.trim(),
                time: new Date(),
                own: true
            });
            chatInput.value = '';
            renderChat();
        });

        renderChat();

        /* =======================
           Project Matchmaking Logic
        ========================= */
        const projectsContainer = document.getElementById('projectsContainer');
        const btnNewProject = document.getElementById('btnNewProject');
        const projectModal = document.getElementById('projectModal');
        const closeProjectModalBtn = document.getElementById('closeProjectModal');
        const projectForm = document.getElementById('projectForm');

        // Dummy projects data
        let projects = [
            {
                id: 1,
                title: "Campus Awareness App",
                desc: "An app to notify students about campus events and emergencies.",
                skills: ["React", "Firebase", "UX Design"],
                teamSize: 5,
                requests: 2
            },
            {
                id: 2,
                title: "Smart Energy Tracker",
                desc: "Dashboard for tracking energy consumption in hostels.",
                skills: ["IoT", "Python", "Data Analysis"],
                teamSize: 4,
                requests: 0
            },
            {
                id: 3,
                title: "Virtual Hackathon Portal",
                desc: "Create a platform for managing virtual hackathons with project submission.",
                skills: ["Node.js", "Express", "MongoDB"],
                teamSize: 6,
                requests: 1
            }
        ];

        function renderProjects() {
            projectsContainer.innerHTML = '';
            projects.forEach(project => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="project-header">
                        <div class="project-title">${project.title}</div>
                        <div class="project-team-size">${project.teamSize} max</div>
                    </div>
                    <div class="project-desc">${project.desc}</div>
                    <div class="project-skills">
                        ${project.skills.map(skill => `<div class="skill">${skill}</div>`).join('')}
                    </div>
                    <button class="join-btn" aria-label="Join request for project ${project.title}">${project.requests > 0 ? `Join Requests (${project.requests}) ` : 'Join Project'}</button>
                `;
                card.querySelector('button').onclick = () => openProjectRequestModal(project.id);
                projectsContainer.appendChild(card);
            });
        }

        btnNewProject.onclick = () => {
            projectModal.classList.add('active');
            projectForm.reset();
            document.getElementById('projectTitle').focus();
        };

        closeProjectModalBtn.onclick = () => {
            projectModal.classList.remove('active');
        };

        projectForm.onsubmit = e => {
            e.preventDefault();
            const title = document.getElementById('projectTitle').value.trim();
            const desc = document.getElementById('projectDesc').value.trim();
            const skills = document.getElementById('projectSkills').value.trim().split(',').map(s => s.trim()).filter(Boolean);
            const teamSize = parseInt(document.getElementById('projectTeamSize').value, 10);
            if(!title || !desc || !skills.length || !teamSize) return;

            projects.unshift({
                id: Date.now(),
                title,
                desc,
                skills,
                teamSize,
                requests: 0
            });

            projectModal.classList.remove('active');
            renderProjects();
            showToast("✓ Project created successfully!");
        };

        function openProjectRequestModal(projectId) {
            const project = projects.find(p => p.id === projectId);
            if(!project) return;

            // Simulate join request increment and feedback
            project.requests++;
            renderProjects();
            showToast(`✓ Join request sent for "${project.title}"`);
        }

        renderProjects();

        /* ======================
           Common utilities
        ======================= */
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.opacity = '1';
            toast.style.transform = 'translateY(0)';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(40px)';
            }, 3500);
        }
    </script>
</body>
</html>
